@model AssignPermissionDTO
@{
    TempData["Title"] = "Assing Permission";
}
<div class="page-header page-header-default">
    <div class="page-header-content">
        <div class="page-title">
            <h4><i class="icon-arrow-left52 position-left"></i> <span class="text-semibold">Assign Permissions</span></h4>
        </div>

        <div class="heading-elements">
            <div class="heading-btn-group">
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-bars-alt text-primary"></i><span>Statistics</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calculator text-primary"></i> <span>Invoices</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calendar5 text-primary"></i> <span>Schedule</span></a>
            </div>
        </div>
    </div>

    <div class="breadcrumb-line">
        <ul class="breadcrumb">
            <li><a asp-action="Index" asp-controller="Home"><i class="icon-home2 position-left"></i> Home</a></li>
            <li><a asp-action="Index" asp-controller="Role">Roles</a></li>
            <li class="active">Assign Permissions</li>
        </ul>

        <ul class="breadcrumb-elements">
            <li><a href="#"><i class="icon-comment-discussion position-left"></i> Support</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <i class="icon-gear position-left"></i>
                    Settings
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu dropdown-menu-right">
                    <li><a href="#"><i class="icon-user-lock"></i> Account security</a></li>
                    <li><a href="#"><i class="icon-statistics"></i> Analytics</a></li>
                    <li><a href="#"><i class="icon-accessibility"></i> Accessibility</a></li>
                    <li class="divider"></li>
                    <li><a href="#"><i class="icon-gear"></i> All settings</a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<div class="content">
    <div class="row">
        <form asp-action="AssignPermissions" asp-controller="Role" asp-route-Id="@Model.Id" method="post">
            <div class="col-md-12">
                <div class="panel panel-flat border-left-md border-left-teal">
                    <div class="panel-heading">
                        <div class="heading-elements">
                            <ul class="icons-list">
                                @* <li><a data-action="collapse" class=""></a></li> *@
                            </ul>
                        </div>
                    </div>

                    <div class="panel-body">
                        <div class="col-md-12">
                            <legend class="text-semibold"><i class="icon-user-lock"></i> Edit Role <span class="label bg-teal-300 label-rounded" style="font-size:15px">@Model.RoleName</span> Permissions</legend>
                        </div>

                        @if (!Model.IsBasic)
                        {
                            <div class="row">
                                <div class="col-md-2">
                                    <label class="checkbox-inline" for="selectAllCheckbox">
                                        <div>
                                            <span>
                                                <input type="checkbox" class="styled" id="selectAllCheckbox" />
                                            </span>
                                        </div>
                                        Select All
                                    </label>
                                </div>
                            </div>
                            
                        }
                        <br />
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr class="border-double">
                                    <th style="width: 20%;"><h4>Permission Group</h4></th>
                                    <th><h4>Permissions</h4></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var group in Model.PermissionGroups)
                                {
                                    <tr>
                                        <td><strong>@group.Key</strong></td>
                                        <td>
                                            <div class="row">
                                                @foreach (var perm in group.Value)
                                                {
                                                    var checkboxId = $"perm_{perm.Action.Replace(" ", "_")}";
                                                    <div class="col-md-3 mb-2">
                                                        <label class="checkbox-inline" for="@checkboxId">
                                                            <input type="checkbox"
                                                                   id="@checkboxId"
                                                                   name="permissionStrings"
                                                                   value="@perm.Action"
                                                                   class="styled permission-checkbox"
                                                            @(perm.IsAssigned ? "checked" : "")
                                                            @(Model.IsBasic ? "disabled" : "") />
                                                            @perm.Action
                                                        </label>
                                                    </div>
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

@*                         @foreach (var group in Model.PermissionGroups)
                        {
                            <div class="row">
                                <div class="col-md-2">
                                    <h5>@group.Key</h5>
                                </div>
                                    <div class="col-md-10" style="padding-top:20px">
                                    @foreach (var perm in group.Value)
                                    {
                                        var checkboxId = $"perm_{perm.Action.Replace(" ", "_")}";
                                        <div class=" col-md-3">
                                        <label class="checkbox-inline" for="@checkboxId">
                                            <div>
                                                <span>
                                                    <input type="checkbox"
                                                           id="@checkboxId"
                                                           name="permissionStrings"
                                                           value="@perm.Action"
                                                           class="styled permission-checkbox"
                                                    @(perm.IsAssigned ? "checked" : "")
                                                    @(Model.IsBasic ? "disabled" : "") />
                                                </span>
                                            </div>
                                            @perm.Action
                                            </label>
                                        </div>
                                    }
                                </div>
                            </div>
                            <hr />
                        }
 *@                    </div>
                </div>
            </div>
            <div class="text-center">
                <a class="btn btn-default btn-lg" asp-action="Index" asp-controller="Role">Cancel</a>
                <button type="submit" class="btn btn-teal-400 btn-lg btn-ladda btn-ladda-spinner ladda-button" data-spinner-color="#fff" data-style="radius" @(Model.IsBasic ? "disabled" : "")>
                    <i class="icon-checkmark4"></i> Save
                </button>
            </div>
        </form>

    </div>
</div>



@section Scripts {
    <script>
        $(function () {
            var $selectAll = $('#selectAllCheckbox');
            var $items = $('input.permission-checkbox');

            // Helper: update the visual plugin if present
            function updatePlugins($elems, checked) {
                // iCheck support
                if ($.fn.iCheck) {
                    $elems.filter(':not(:disabled)').iCheck(checked ? 'check' : 'uncheck');
                    return;
                }
                // Uniform support (older plugin)
                if (typeof $.uniform !== 'undefined') {
                    // set native checked then update uniform visuals
                    $elems.each(function () {
                        if (!this.disabled) this.checked = checked;
                    });
                    $.uniform.update($elems);
                    return;
                }
                // Fallback: set native checked + trigger change so any handlers update
                $elems.each(function () {
                    if (this.disabled) return;
                    if (this.checked !== checked) {
                        this.checked = checked;
                        $(this).trigger('change');
                    }
                });
            }

            // Select All toggle
            $selectAll.on('change', function () {
                var checked = this.checked;
                updatePlugins($items, checked);
            });

            // When any individual checkbox changes, update Select All state.
            // Listen to both iCheck event and normal change
            $items.on('ifChanged change', function () {
                var $enabled = $items.filter(':not(:disabled)');
                var allChecked = $enabled.length && ($enabled.filter(':checked').length === $enabled.length);
                $selectAll.prop('checked', !!allChecked);
            });
        });
    </script>

    @await Html.PartialAsync("_ValidationScriptsPartial")
}

