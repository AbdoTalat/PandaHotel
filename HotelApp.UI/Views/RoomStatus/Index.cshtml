@model IEnumerable<GetAllRoomStatusDTO>
@{
	TempData["Title"] = "Room Status";
}

<!-- Page header -->
<div class="page-header page-header-default">
	<div class="page-header-content">
		<div class="page-title">
			<h4><i class="icon-arrow-left52 position-left"></i> <span class="text-semibold">Room Statuses</span></h4>
		</div>

		<div class="heading-elements">
			<div class="heading-btn-group">
				<a href="#" class="btn btn-link btn-float has-text"><i class="icon-bars-alt text-primary"></i><span>Statistics</span></a>
				<a href="#" class="btn btn-link btn-float has-text"><i class="icon-calculator text-primary"></i> <span>Invoices</span></a>
				<a href="#" class="btn btn-link btn-float has-text"><i class="icon-calendar5 text-primary"></i> <span>Schedule</span></a>
			</div>
		</div>
	</div>

	<div class="breadcrumb-line">
		<ul class="breadcrumb">
			<li><a asp-action="Index" asp-controller="Home"><i class="icon-home2 position-left"></i> Home</a></li>
			<li class="active">Room Status (@Model.Count())</li>
		</ul>

		<ul class="breadcrumb-elements">
			<li><a href="#"><i class="icon-comment-discussion position-left"></i> Support</a></li>
			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">
					<i class="icon-gear position-left"></i>
					Settings
					<span class="caret"></span>
				</a>

				<ul class="dropdown-menu dropdown-menu-right">
					<li><a href="#"><i class="icon-user-lock"></i> Account security</a></li>
					<li><a href="#"><i class="icon-statistics"></i> Analytics</a></li>
					<li><a href="#"><i class="icon-accessibility"></i> Accessibility</a></li>
					<li class="divider"></li>
					<li><a href="#"><i class="icon-gear"></i> All settings</a></li>
				</ul>
			</li>
		</ul>
	</div>
</div>
<!-- /page header -->

<!-- Content area -->
<div class="content ">
	<!-- Basic datatable -->
	<div class="panel panel-flat ">
		<div class="panel-heading">
			<h5 class="panel-title">Room Statuses</h5>

			<div class="heading-elements">
				@if ((await AuthorizationService.AuthorizeAsync(User, "RoomStatus.Add")).Succeeded)
				{
					<button data-title="Add New Room Status" data-url="/RoomStatus/AddRoomStatus" type="button" class="btn bg-teal-400 btn-lg btnOpenModal">
						<i class="icon-plus-circle2" style="font-size:21px; margin-right:0px; margin-top:3px"></i>
						Add Room Status
					</button>
				}
			</div>
		</div>

		<hr class="my-3" style="margin-top:5px">

		<div class="panel-heading" style="margin-bottom:40px">
			<div class="heading-elements">
				<ul class="icons-list">
					<li><button id="toggleFilterBtn" class="btn bg-teal-400 "><i class="icon-filter3"></i> Filter</button></li>
					<li><a class="btn bg-teal-400" style="color:#fff" id="" data-action="reload"></a></li>
					<li><a class="btn bg-teal-400" style="color:#fff" data-action="collapse"></a></li>
				</ul>
			</div>
		</div>
		<table class="table datatable-button-html5-basic dataTable" id="MyTable">
			<thead>
				<tr class="border-double">
					<th>#</th>
					<th>Status Name</th>
					<th>Description</th>
					<th>Color</th>
					<th>Is Active</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr id="item-@item.Id">
                        <td>
							<a class="text-primary">@item.Id</a>
						</td>
						<td>@item.Name</td>
						<td>@item.Description</td>
						<td>
							<div style="background-color:@item.Color; width: 30px; height: 30px; border-radius: 4px; display: inline-block; border: 1px solid #ccc;" title="@item.Color"></div>
							<span class="ml-2">@item.Color</span>
						</td>
						@if (item.IsActive)
						{
							<td><span class="label label-rounded label-success">Active</span></td>
						}
						else
						{
							<td><span class="label label-rounded label-danger">Not Active</span></td>
						}
						<td>
							@if ((await AuthorizationService.AuthorizeAsync(User, "RoomStatus.Edit")).Succeeded)
							{
								<a data-title="Edit Room Status" data-url="/RoomStatus/EditRoomStatus/@item.Id" class="text-teal-600 btnEditOpenModal"><i class="icon-pencil7" style="font-size:20px; margin-right:8px"></i> </a>
							}
							@if ((await AuthorizationService.AuthorizeAsync(User, "RoomStatus.Delete")).Succeeded)
							{
								@if (!item.IsActive)
								{
									<a data-id="@item.Id" class="text-danger-600 btn-delete"><i class="icon-trash" style="font-size:20px;margin-right:8px"></i> </a>
								}
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
	<!-- /basic datatable -->
</div>
<!-- /content area -->


@section Scripts {

	<script>
		$(document).ready(function () {
			const swalWithBootstrapButtons = Swal.mixin({
				customClass: {
					confirmButton: 'btn btn-danger',
					cancelButton: 'btn bg-teal-400 custom-cancel-btn'
				},
				buttonsStyling: false
			});

			// Use event delegation to handle dynamically created elements
			$('#MyTable tbody').on('click', '.btn-delete', function () {
				let button = $(this);  // Reference to the clicked button
				let itemId = button.data("id");
				let row = button.closest("tr");

				swalWithBootstrapButtons.fire({
					position: "top",
					title: "Are you sure?",
					text: "You won't be able to revert this!",
					icon: "warning",
					iconColor: "red",
					showCancelButton: true,
					confirmButtonText: "Delete!",
					cancelButtonText: "Cancel",
					reverseButtons: true
				}).then((result) => {
					if (result.isConfirmed) {
						$.ajax({
							url: '/RoomType/DeleteRoomType/' + itemId,
							type: 'DELETE',
							success: function (response) {
								if (response.success) {
									swalWithBootstrapButtons.fire({
										position: "top",
										title: "Deleted!",
										text: response.message,
										icon: "success",
										//toast: true,
										customClass: {
											confirmButton: 'btn btn-success'
										}
									}).then(() => {
										row.fadeOut(400, function () { // Fade out the row smoothly
											$(this).remove(); // Remove the row from DOM
										});
									});
								} else {
									swalWithBootstrapButtons.fire({
										position: "top",
										title: "Warning!",
										text: response.message,
										icon: "warning"
									});
								}
							},
							error: function () {
								swalWithBootstrapButtons.fire({
									position: "top",
									title: "Error!",
									text: "Something went wrong!",
									icon: "error"
								});
							}
						});
					}
				});
			});
		});
	</script>
}
