@model EditRoomDTO

<form class="form-basic ajaxEditForm" asp-action="EditRoom" asp-controller="Room" method="post">
	<input type="hidden" asp-for="Id" />
	<div class="panel panel-flat border-left-lg border-left-teal">
		<div class="panel-body">
			<div class="content">
				<fieldset class="step" id="step1">

					<div class="row">
						<div class="col-md-6">
							<label>Room Number<span class="text-danger">*</span></label>
							<div class="form-group">
								<input asp-for="RoomNumber" class="form-control box-input" placeholder="First Name" required>
								<span asp-validation-for="RoomNumber" class="text-danger validation-error-label"></span>
							</div>
						</div>
						<div class="col-md-6">
							<label>Floor<span class="text-danger">*</span></label>
							<div class="form-group">
								<select data-selected="@Model.FloorId" asp-for="FloorId" id="floorSelect" name="FloorId" class="form-control" required data-placeholder="Select Status">
									<option value=""></option>
								</select>
								<span asp-validation-for="FloorId" class="text-danger validation-error-label"></span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<label>Room Status<span class="text-danger">*</span></label>
							<div class="form-group ">
								<select data-selected="@Model.RoomStatusId" asp-for="RoomStatusId" id="StatusSelect" name="RoomStatusId" class="form-control select2 ui-wizard-content" required data-placeholder="Select Status">
									<option value=""></option>
								</select>
								<span asp-validation-for="RoomStatusId" class="text-danger validation-error-label"></span>
							</div>
						</div>
						<div class="col-md-6">
							<label>Room Type<span class="text-danger">*</span></label>
							<div class="form-group">
								<select data-selected="@Model.RoomTypeId" asp-for="RoomTypeId" id="roomTypeSelect" name="RoomTypeId" required class="form-control" placeholder="Select Room Type">
									<option></option>
								</select>
								<span asp-validation-for="RoomTypeId" class="text-danger validation-error-label"></span>
							</div>
						</div>
					</div>

					<div class="row">

						<div class="col-md-4">
							<label>Max Num Of Adults<span class="text-danger">*</span></label>
							<div class="form-group">
								<input asp-for="MaxNumOfAdults" class="form-control" id="maxNumOfAdults" placeholder="Max Num Of Adults">
								<span class="text-danger validation-error-label" asp-validation-for="MaxNumOfAdults"></span>
							</div>
						</div>
						<div class="col-md-4">
							<label>Max Num Of Childrens<span class="text-danger">*</span></label>
							<div class="form-group">
								<input asp-for="MaxNumOfChildrens" class="form-control" id="maxNumOfChildren" placeholder="Max Num Of Childrens" />
								<span class="text-danger validation-error-label" asp-validation-for="MaxNumOfChildrens"></span>
							</div>
						</div>
						<div class="col-md-4">
							<label>Price Per Night<span class="text-danger">*</span></label>
							<div class="form-group">
								<input asp-for="PricePerNight" class="form-control" id="roomPrice" placeholder="Price per Night">
								<span class="text-danger validation-error-label" asp-validation-for="PricePerNight"></span>
							</div>
						</div>
					</div>

					<div class="row">

						<div class="col-md-12">
							<label>Description<span class="text-danger">*</span></label>
							<div class="form-group">
								<textarea asp-for="Description" class="form-control" style="min-width:780px; min-height:100px" placeholder="Room Description"></textarea>
								<span class="text-danger validation-error-label" asp-validation-for="Description"></span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="panel panel-flat">
								<div class="panel-heading">
									<h6 class="panel-title">More Room Setup<a class="heading-elements-toggle"><i class="icon-more"></i></a></h6>
								</div>

								<div class="panel-body">
									<div class="form-group alpaca-field alpaca-field-checkbox alpaca-optional checkbox-styled-list alpaca-edit alpaca-top alpaca-field-valid">
										<label class="control-label alpaca-control-label"></label>

										<div class="alpaca-control checkbox">
											<label class="checkbox-inline checkbox-left checkbox-switchery switchery-sm">
												<input type="checkbox" asp-for="IsActive" class="switchery" 
													   checked="@(Model.IsActive ? "checked" : null)">

												Is Active
											</label>
										</div>
										<div class="alpaca-control checkbox">
											<label class="checkbox-inline checkbox-left checkbox-switchery switchery-sm">
                                                <input type="checkbox" asp-for="IsAffectedByRoomType" class="switchery"
													checked="@(Model.IsAffectedByRoomType ? "checked" : null)" >
												Is Affected by Room Type
											</label>
										</div>

									</div>
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="panel panel-flat">
								<div class="panel-heading">
									<h6 class="panel-title">Select Room Options:</h6>
								</div>
								<div class="panel-body">
									<div class="form-group">
										<div id="options-container">
											@foreach (var option in ViewBag.Options)
											{
												<div class="checkbox">
													<input type="checkbox" name="SelectedOptions"
														   value="@option.Id" id="option-@option.Id"
														   class="styled"
													@(Model.AssignOptions.Contains(option.Id) ? "checked" : "")>
													<label for="option-@option.Id">@option.Name</label>
												</div>
											}
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>

				</fieldset>
			</div>
		</div>
	</div>
	<div class="text-right">
		<button class="btn btn-link" data-dismiss="modal"> Cancel</button>
		<button type="submit" class="btn bg-teal-400 btn-lg"><i class="icon-checkmark4"></i> Save</button>
	</div>
</form>


<script>
	$(document).ready(function () {
		var selectedRoomTypeId = $("#roomTypeSelect").data("selected");
		$.ajax({
			url: '/RoomType/GetRoomTypesJson',
			type: 'GET',
			dataType: 'json',
			success: function (response) {
				var select = $('#roomTypeSelect');
				select.empty();
				select.append('<option value="">Select Room Type</option>');

				$.each(response, function (index, item) {
					var isSelected = item.id == selectedRoomTypeId ? 'selected' : '';
					select.append('<option value="' + item.id + '" ' + isSelected + '>' + item.typeName + '</option>');
				});
			},
			error: function () {
				console.error('Failed to load room types.');
			}
		});
	});

	$(document).ready(function () {
		var selectedFloorId = $("#floorSelect").data("selected"); 

		$.ajax({
			url: '/Floor/GetFloorsJson',
			type: 'GET',
			dataType: 'json',
			success: function (response) {
				var select = $('#floorSelect');
				select.empty();
				select.append('<option value="">Select Floor</option>');

				$.each(response, function (index, item) {
					var isSelected = item.id == selectedFloorId ? 'selected' : ''; // Check if it's the selected value
					select.append('<option value="' + item.id + '" ' + isSelected + '>' + item.number + '</option>');
				});
			},
			error: function () {
				console.error('Failed to load room types.');
			}
		});
	});

	$(document).ready(function () {
		var selectedRoomStatusId = $("#StatusSelect").data("selected");
		$.ajax({
			url: '/RoomStatus/GetRoomStatusJson',
			type: 'GET',
			dataType: 'json',
			success: function (response) {
				var select = $('#StatusSelect');
				select.empty();
				select.append('<option value="">Select Status</option>');

				$.each(response, function (index, item) {
					var isSelected = item.id == selectedRoomStatusId ? 'selected' : '';
					select.append('<option value="' + item.id + '" ' + isSelected + '>' + item.name + '</option>');
				});
			},
			error: function () {
				console.error('Failed to load room types.');
			}
		});
	});
</script>

<script>
	var elems = Array.prototype.slice.call(document.querySelectorAll('.switchery'));
	elems.forEach(function (html) {
		new Switchery(html, { color: '#4CAF50', size: 'small' });
	});

	</script>

<script>
	$(document).ready(function () {
		$('#StatusSelect').select2({
			placeholder: "Select options"
		});
	});

	$(document).ready(function () {
		$('#roomTypeSelect').select2({
			placeholder: "Select options"
		});
	});

	$(document).ready(function () {
		$('#floorSelect').select2({
			placeholder: "Select options"
		});
	});

</script>

<script>
	$(document).ready(function () {
		$('#roomTypeSelect').change(function () {
			var roomTypeId = $(this).val();
			if (roomTypeId) {
				$.get('/RoomType/GetRoomTypeData', { roomTypeId: roomTypeId }, function (response) {
					if (response.success) {
						$('#roomPrice').val(response.price);
						$('#maxNumOfAdults').val(response.maxAdults);
						$('#maxNumOfChildren').val(response.maxChildren);
					} else {
						alert(response.message);
						$('#roomPrice').val('');
						$('#maxNumOfAdults').val('');
						$('#maxNumOfChildren').val('');
					}
				});
			} else {
				$('#roomPrice').val('');
				$('#maxNumOfAdults').val('');
				$('#maxNumOfChildren').val('');
			}
		});
	});
</script>

@await Html.PartialAsync("_ValidationScriptsPartial")