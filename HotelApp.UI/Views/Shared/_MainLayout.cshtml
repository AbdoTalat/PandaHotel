@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

@using HotelApp.Application.DTOs.UserBranches
@using Newtonsoft.Json
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@using System.Security.Claims

@{
	 var user = UserManager.GetUserAsync(User).Result;

}

@{
	//var defaultBranchId = User.FindFirstValue("DefaultBranch");
	var defaultBranchJson = User.FindFirstValue("DefaultBranchData");

	var defaultBranch = string.IsNullOrEmpty(defaultBranchJson)
		? null
		: JsonConvert.DeserializeObject<UserBranchesDataDTO>(defaultBranchJson);


	var userBranchesJson = User.FindFirstValue("UserBranchesData");

	var userBranches = string.IsNullOrEmpty(userBranchesJson)
		? new List<UserBranchesDataDTO>()
		: JsonConvert.DeserializeObject<List<UserBranchesDataDTO>>(userBranchesJson);
}

@{
	bool canViewUsers = (await AuthorizationService.AuthorizeAsync(User, "User.View")).Succeeded;
	bool canViewRoles = (await AuthorizationService.AuthorizeAsync(User, "Role.View")).Succeeded;
	bool canViewRooms = (await AuthorizationService.AuthorizeAsync(User, "Room.View")).Succeeded;
	bool canViewRoomTypes = (await AuthorizationService.AuthorizeAsync(User, "RoomType.View")).Succeeded;
	bool canViewRoomStatus = (await AuthorizationService.AuthorizeAsync(User, "RoomStatus.View")).Succeeded;
	bool canViewGuests = (await AuthorizationService.AuthorizeAsync(User, "Guest.View")).Succeeded;
	bool canViewReservations = (await AuthorizationService.AuthorizeAsync(User, "Reservation.View")).Succeeded;
	bool canViewBranches = (await AuthorizationService.AuthorizeAsync(User, "Branch.View")).Succeeded;
	bool canViewFloors = (await AuthorizationService.AuthorizeAsync(User, "Floor.View")).Succeeded;
	bool canViewOptions = (await AuthorizationService.AuthorizeAsync(User, "Option.View")).Succeeded;
	bool canViewRates = (await AuthorizationService.AuthorizeAsync(User, "Rate.View")).Succeeded;
	bool canViewSystemSettings = (await AuthorizationService.AuthorizeAsync(User, "SystemSetting.Edit")).Succeeded;
	bool canViewReports = (await AuthorizationService.AuthorizeAsync(User, "Report.View")).Succeeded;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PandaHotel - @TempData["Title"]</title>
   
	<!-- Global stylesheets -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css">
	<link href="/assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
	<link href="/assets/css/bootstrap.css?v=1.4" rel="stylesheet" type="text/css">
	<link href="/assets/css/core.css?v=1.5" rel="stylesheet" type="text/css">
	<link href="/assets/css/components.css" rel="stylesheet" type="text/css">
	<link href="/assets/css/colors.css" rel="stylesheet" type="text/css">
	<link href="/css/site.css?v=1.2" rel="stylesheet" />
    <!-- /global stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

	<!-- Core JS files -->
	<script type="text/javascript" src="/assets/js/plugins/loaders/pace.min.js"></script>
	<script type="text/javascript" src="/assets/js/core/libraries/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/js/core/libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/plugins/loaders/blockui.min.js"></script>
	<!-- /core JS files -->

	<!-- Theme JS files -->
	<script type="text/javascript" src="/assets/js/plugins/forms/styling/uniform.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/styling/switchery.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/styling/switch.min.js"></script>
	<script type="text/javascript" src="/assets/js/core/libraries/jquery_ui/core.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/wizards/form_wizard/form.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/wizards/form_wizard/form_wizard.min.js"></script>
	<script type="text/javascript" src="/assets/js/core/libraries/jasny_bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/validation/validate.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/notifications/sweet_alert.min.js"></script>
	<script type="text/javascript" src="/assets/js/pages/wizard_form.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/selects/select2.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/tables/datatables/datatables.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/tables/datatables/extensions/jszip/jszip.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/tables/datatables/extensions/pdfmake/pdfmake.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/tables/datatables/extensions/pdfmake/vfs_fonts.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/tables/datatables/extensions/buttons.min.js"></script>
	<script type="text/javascript" src="/assets/js/pages/datatables_extension_buttons_html5.js"></script>
	<script type="text/javascript" src="/assets/js/pages/datatables_basic.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/notifications/pnotify.min.js"></script>
    <script type="text/javascript" src="/assets/js/pages/datatables_api.js"></script>
	<script type="text/javascript" src="/assets/js/core/libraries/jquery_ui/interactions.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/notifications/bootbox.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/notifications/noty.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/notifications/jgrowl.min.js"></script>
	<script type="text/javascript" src="/assets/js/pages/components_popups.js"></script>
	<script type="text/javascript" src="/assets/js/pages/components_notifications_other.js"></script>
	<script type="text/javascript" src="/assets/js/pages/components_notifications_pnotify.js"></script>
	<script type="text/javascript" src="/assets/js/pages/components_modals.js"></script>

	<script type="text/javascript" src="/assets/js/plugins/ui/moment/moment.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/daterangepicker.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/anytime.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/pickadate/picker.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/pickadate/picker.date.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/pickadate/picker.time.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/pickers/pickadate/legacy.js"></script>
	<script type="text/javascript" src="/assets/js/pages/picker_date.js?v=1.11"></script>
    <script type="text/javascript" src="/assets/js/plugins/ui/fab.min.js"></script>
    <script type="text/javascript" src="/assets/js/plugins/ui/prism.min.js"></script>

    <script type="text/javascript" src="/assets/js/plugins/pickers/color/spectrum.js"></script>
    <script type="text/javascript" src="/assets/js/pages/picker_color.js"></script>

	<script type="text/javascript" src="/assets/js/plugins/forms/inputs/touchspin.min.js?v=1.3"></script>
	<script type="text/javascript" src="/assets/js/pages/form_input_groups.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/forms/wizards/steps.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/extensions/cookie.js"></script>

	<script type="text/javascript" src="/assets/js/pages/wizard_steps.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/velocity/velocity.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/velocity/velocity.ui.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/buttons/spin.min.js"></script>
	<script type="text/javascript" src="/assets/js/plugins/buttons/ladda.min.js"></script>

	<script type="text/javascript" src="/assets/js/pages/components_buttons.js"></script>

	
	<script type="text/javascript" src="/assets/js/plugins/forms/selects/bootstrap_multiselect.js"></script>

	<script type="text/javascript" src="/assets/js/pages/form_multiselect.js"></script>


	<!-- Advanced Animation -->
	@* <script type="text/javascript" src="/assets/js/pages/animations_velocity_examples.js"></script> *@

    <script type="text/javascript" src="/assets/js/core/app.js"></script>
   
	@RenderSection("ThemeScripts", false)
    <!-- /theme JS files -->
    
</head>


<body class="navbar-top">

	<!-- Main navbar -->
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-header">
			<a class="navbar-brand" href="#"><img src="/assets/images/logo_light.png" alt=""></a>

			<ul class="nav navbar-nav visible-xs-block">
				<li><a data-toggle="collapse" data-target="#navbar-mobile"><i class="icon-tree5"></i></a></li>
				<li><a class="sidebar-mobile-main-toggle"><i class="icon-paragraph-justify3"></i></a></li>
			</ul>
		</div>

		<div class="navbar-collapse collapse" id="navbar-mobile">
			<ul class="nav navbar-nav">
				<li><a class="sidebar-control sidebar-main-toggle hidden-xs"><i class="icon-paragraph-justify3"></i></a></li>

				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="icon-git-compare"></i>
						<span class="visible-xs-inline-block position-right">Git updates</span>
						<span class="badge bg-warning-400">9</span>
					</a>

					<div class="dropdown-menu dropdown-content">
						<div class="dropdown-content-heading">
							Git updates
							<ul class="icons-list">
								<li><a href="#"><i class="icon-sync"></i></a></li>
							</ul>
						</div>

						<ul class="media-list dropdown-content-body width-350">
							<li class="media">
								<div class="media-left">
									<a href="#" class="btn border-primary text-primary btn-flat btn-rounded btn-icon btn-sm"><i class="icon-git-pull-request"></i></a>
								</div>

								<div class="media-body">
									Drop the IE <a href="#">specific hacks</a> for temporal inputs
									<div class="media-annotation">4 minutes ago</div>
								</div>
							</li>

							<li class="media">
								<div class="media-left">
									<a href="#" class="btn border-warning text-warning btn-flat btn-rounded btn-icon btn-sm"><i class="icon-git-commit"></i></a>
								</div>

								<div class="media-body">
									Add full font overrides for popovers and tooltips
									<div class="media-annotation">36 minutes ago</div>
								</div>
							</li>

							<li class="media">
								<div class="media-left">
									<a href="#" class="btn border-info text-info btn-flat btn-rounded btn-icon btn-sm"><i class="icon-git-branch"></i></a>
								</div>

								<div class="media-body">
									<a href="#">Chris Arney</a> created a new <span class="text-semibold">Design</span> branch
									<div class="media-annotation">2 hours ago</div>
								</div>
							</li>

							<li class="media">
								<div class="media-left">
									<a href="#" class="btn border-success text-success btn-flat btn-rounded btn-icon btn-sm"><i class="icon-git-merge"></i></a>
								</div>

								<div class="media-body">
									<a href="#">Eugene Kopyov</a> merged <span class="text-semibold">Master</span> and <span class="text-semibold">Dev</span> branches
									<div class="media-annotation">Dec 18, 18:36</div>
								</div>
							</li>

							<li class="media">
								<div class="media-left">
									<a href="#" class="btn border-primary text-primary btn-flat btn-rounded btn-icon btn-sm"><i class="icon-git-pull-request"></i></a>
								</div>

								<div class="media-body">
									Have Carousel ignore keyboard events
									<div class="media-annotation">Dec 12, 05:46</div>
								</div>
							</li>
						</ul>

						<div class="dropdown-content-footer">
							<a href="#" data-popup="tooltip" title="All activity"><i class="icon-menu display-block"></i></a>
						</div>
					</div>
				</li>
			</ul>

			<p class="navbar-text"><span class="label bg-success">Online</span></p>


            <ul class="nav navbar-nav navbar-right">
				
				<li class="dropdown language-switch">
					<a class="dropdown-toggle" data-toggle="dropdown">
						<img src="/assets/images/flags/gb.png" class="position-left" alt="">
						English
						<span class="caret"></span>
					</a>

					<ul class="dropdown-menu">
						<li><a class="deutsch"><img src="/assets/images/flags/de.png" alt=""> Deutsch</a></li>
						<li><a class="ukrainian"><img src="/assets/images/flags/ua.png" alt=""> Українська</a></li>
						<li><a class="english"><img src="/assets/images/flags/gb.png" alt=""> English</a></li>
						<li><a class="espana"><img src="/assets/images/flags/es.png" alt=""> España</a></li>
						<li><a class="russian"><img src="/assets/images/flags/ru.png" alt=""> Русский</a></li>
					</ul>
				</li>

				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="icon-bubbles4"></i>
						<span class="visible-xs-inline-block position-right">Messages</span>
						<span class="badge bg-warning-400">2</span>
					</a>

					<div class="dropdown-menu dropdown-content width-350">
						<div class="dropdown-content-heading">
							Messages
							<ul class="icons-list">
								<li><a href="#"><i class="icon-compose"></i></a></li>
							</ul>
						</div>

						<ul class="media-list dropdown-content-body">
							<li class="media">
								<div class="media-left">
									<img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt="">
									<span class="badge bg-danger-400 media-badge">5</span>
								</div>

								<div class="media-body">
									<a href="#" class="media-heading">
										<span class="text-semibold">James Alexander</span>
										<span class="media-annotation pull-right">04:58</span>
									</a>

									<span class="text-muted">who knows, maybe that would be the best thing for me...</span>
								</div>
							</li>

							<li class="media">
								<div class="media-left">
									<img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt="">
									<span class="badge bg-danger-400 media-badge">4</span>
								</div>

								<div class="media-body">
									<a href="#" class="media-heading">
										<span class="text-semibold">Margo Baker</span>
										<span class="media-annotation pull-right">12:16</span>
									</a>

									<span class="text-muted">That was something he was unable to do because...</span>
								</div>
							</li>

							<li class="media">
								<div class="media-left"><img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt=""></div>
								<div class="media-body">
									<a href="#" class="media-heading">
										<span class="text-semibold">Jeremy Victorino</span>
										<span class="media-annotation pull-right">22:48</span>
									</a>

									<span class="text-muted">But that would be extremely strained and suspicious...</span>
								</div>
							</li>

							<li class="media">
								<div class="media-left"><img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt=""></div>
								<div class="media-body">
									<a href="#" class="media-heading">
										<span class="text-semibold">Beatrix Diaz</span>
										<span class="media-annotation pull-right">Tue</span>
									</a>

									<span class="text-muted">What a strenuous career it is that I've chosen...</span>
								</div>
							</li>

							<li class="media">
								<div class="media-left"><img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt=""></div>
								<div class="media-body">
									<a href="#" class="media-heading">
										<span class="text-semibold">Richard Vango</span>
										<span class="media-annotation pull-right">Mon</span>
									</a>

									<span class="text-muted">Other travelling salesmen live a life of luxury...</span>
								</div>
							</li>
						</ul>

						<div class="dropdown-content-footer">
							<a href="#" data-popup="tooltip" title="All messages"><i class="icon-menu display-block"></i></a>
						</div>
					</div>
				</li>

				
				

				<li class="dropdown dropdown-user">
					<a class="dropdown-toggle" data-toggle="dropdown">
						<img src="/assets/images/placeholder.jpg" alt="">
						<span>@user.UserName</span>
						<i class="caret"></i>
					</a>

					<ul class="dropdown-menu dropdown-menu-right">
						<li><a href="#"><i class="icon-user-plus"></i> My profile</a></li>

						<li class="dropdown-submenu dropdown-submenu-left">
							<a href="#"><i class="icon-location4"></i> Branches </a>
							<ul class="dropdown-menu">

                                <li >

									@foreach (var item in userBranches)
									{
										<a href="#" class="branch-item" data-branch-id="@item.Id">@item.Name</a>
									}

									<script>
										$(document).ready(function () {
											$(".branch-item").click(function (e) {
												e.preventDefault(); // Prevent page jump
												var branchId = $(this).data("branch-id");

												if (branchId) {
													$.ajax({
														url: '/User/ChangeDefaultBranch',
														type: 'POST',
														contentType: 'application/json',
														data: JSON.stringify(branchId),
														success: function () {
															location.reload(); // Reload to apply changes
														},
														error: function (xhr, status, error) {
															console.error("Error changing branch:", error);
														}
													});
												}
											});
										});
									</script>


                                </li>
							</ul>
						</li>

						


						<li><a href="#"><span class="badge bg-teal-400 pull-right">58</span> <i class="icon-comment-discussion"></i> Messages</a></li>
						<li class="divider"></li>
						<li><a href="#"><i class="icon-cog5"></i> Account settings</a></li>
						<li><a asp-action="LogOut" asp-controller="Account"><i class="icon-exit3"></i> Logout</a></li>
					
					</ul>
                </li>

                
			</ul>
		</div>
	</div>
	<!-- /main navbar -->

	<!-- Page container -->
	<div class="page-container">

		<!-- Page content -->
        <div class="page-content ">

			<!-- Main sidebar -->
			<div class="sidebar sidebar-main navbar-collapse ">
				<div class="sidebar-content">

					<!-- User menu -->
					<div class="sidebar-user">
						<div class="category-content">
							<div class="media">
								<a href="#" class="media-left"><img src="/assets/images/placeholder.jpg" class="img-circle img-sm" alt=""></a>
								<div class="media-body">
									<span class="media-heading text-semibold">@defaultBranch.Name</span>

								</div>

								<div class="media-right media-middle">
									<ul class="icons-list">
										<li>
											<a href="#"><i class="icon-cog3"></i></a>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>

					<!-- /user menu -->

					<div class="sidebar-category sidebar-category-visible">
						<div class="category-content no-padding">
							<ul class="navigation navigation-main navigation-accordion">


								<!-- Main -->
								<li class="navigation-header"><span>Main</span> <i class="icon-menu" title="Main pages"></i></li>
								<li class="@(ViewContext.RouteData.Values["controller"].ToString() == "Home" && ViewContext.RouteData.Values["action"].ToString() == "Index" ? "active" : "")">
									<a asp-action="Index" asp-controller="Home"><i class="icon-home"></i> <span>Dashboard</span></a>
								</li>

								

								@if (canViewUsers || canViewRoles)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Admin") == true ? "active navigation-open" : "")">
										<a href="#"><i class="icon-users4"></i> <span>Administration</span></a>
										<ul>
											@if (canViewUsers)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "User" ? "active" : "")">
													<a asp-action="GetUsers" asp-controller="User"><i class="icon-users2"></i> Users</a>
												</li>
											}
											@if (canViewRoles)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Role" && ViewContext.RouteData.Values["action"]?.ToString() == "GetRoles" ? "active" : "")">
													<a asp-action="GetRoles" asp-controller="Role"><i class="icon-cog52"></i> Roles</a>
												</li>
											}
										</ul>
									</li>
								}

								@if (canViewRooms || canViewRoomTypes || canViewRoomStatus)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Room") == true ? "active navigation-open" : "")">
										<a href="#"><i class="icon-library2"></i> <span>Rooms Management</span></a>
										<ul>
											@if (canViewRooms)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Room" ? "active" : "")">
													<a asp-action="Index" asp-controller="Room"><i class="icon-bed2"></i> Rooms</a>
												</li>
											}
											@if (canViewRoomTypes)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "RoomType" ? "active" : "")">
													<a asp-action="Index" asp-controller="RoomType"><i class="glyphicon glyphicon-tags"></i> Room Types</a>
												</li>
											}
											@if (canViewRoomStatus)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "RoomStatus" ? "active" : "")">
													<a asp-action="Index" asp-controller="RoomStatus"><i class="icon-loop"></i> Room Status</a>
												</li>
											}
										</ul>
									</li>
								}

								@if (canViewGuests)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Guest" ? "active" : "")">
										<a asp-action="Index" asp-controller="Guest"><i class="icon-man-woman"></i> <span>Guests</span></a>
									</li>
								}

								@if (canViewReservations)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Reservation") == true ? "active navigation-open" : "")">
										<a href="#"><i class="icon-file-spreadsheet2"></i> <span>Reservation Management</span></a>
										<ul>
											<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Reservation" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")">
												<a asp-action="Index" asp-controller="Reservation"><i class="icon-calendar"></i> Reservations</a>
											</li>
											<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Reservation" && ViewContext.RouteData.Values["action"]?.ToString() == "Reservation" ? "active" : "")">
												<a href="#"><i class="icon-list-unordered" style="font-size:13px"></i> More</a>
											</li>
										</ul>
									</li>
								}

								@if (canViewBranches || canViewFloors || canViewOptions || canViewRates || canViewSystemSettings)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Branch") == true ? "active navigation-open" : "")">
										<a href="#"><i class="icon-hammer-wrench"></i> <span>System Settings</span></a>
										<ul>
											@if (canViewSystemSettings)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "SystemSetting" ? "active" : "")">
													<a asp-action="Edit" asp-controller="SystemSetting"><i class="icon-cog52"></i> Master System Settings</a>
												</li>
											}
											@if (canViewBranches)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Branch" ? "active" : "")">
													<a asp-action="Index" asp-controller="Branch"><i class="icon-location4"></i> Branches</a>
												</li>
											}
											@if (canViewFloors)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Floor" ? "active" : "")">
													<a asp-action="Index" asp-controller="Floor"><i class="icon-package"></i> Floors</a>
												</li>
											}
											@if (canViewOptions || canViewRates)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Option") == true ? "active navigation-open" : "")">
													<a href="#" class="has-ul"><i class="icon-stats-growth"></i>Rates</a>
													<ul>
														@if (canViewOptions)
														{
															<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Option" ? "active" : "")">
																<a asp-action="Index" asp-controller="Option"><i class="icon-primitive-dot"></i> Options</a>
															</li>
														}
														@if (canViewRates)
														{
															<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Rate" ? "active" : "")">
																<a asp-action="Index" asp-controller="Rate"><i class="icon-primitive-dot"></i> Room Type Rates</a>
															</li>
														}
													</ul>
												</li>
											}
										</ul>
									</li>
								}

								@if (canViewReports)
								{
									<li class="@(ViewContext.RouteData.Values["controller"]?.ToString().Contains("Report") == true ? "active navigation-open" : "")">
										<a href="#"><i class="icon-magazine"></i> <span>Reports</span></a>
										<ul>

											@if (canViewReports)
											{
												<li class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Report" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")">
													<a asp-action="Index" asp-controller="Report"><i class="icon-list3"></i> Room Reports</a>
												</li>
											}
										</ul>
									</li>
								}
							</ul>
						</div>
					</div>
					<!-- /main navigation -->

				</div>
			</div>
			<!-- /main sidebar -->

			<!-- Main content -->
			<div class="content-wrapper ">

				@RenderBody()

				<div class="content">
				<ul class="fab-menu fab-menu-fixed fab-menu-bottom-right" data-fab-toggle="click" data-fab-state="closed">
					<li>
						<a class="fab-menu-btn btn bg-teal-400 btn-float btn-rounded btn-icon">
							<i class="fab-icon-open icon-paragraph-justify3"></i>
							<i class="fab-icon-close icon-cross2"></i>
						</a>

						<ul class="fab-menu-inner">
							<li>
								<div data-fab-label="Compose email">
									<a href="#" class="btn bg-teal-400 btn-rounded btn-icon btn-float">
										<i class="icon-pencil"></i>
									</a>
								</div>
							</li>
							<li>
								<div data-fab-label="Conversations">
									<a href="#" class="btn bg-teal-400 btn-rounded btn-icon btn-float">
										<i class="icon-bubbles7"></i>
									</a>
									<span class="badge bg-primary-400">5</span>
								</div>
							</li>
							<li>
								<div data-fab-label="Chat with Jack">
									<a href="#" class="btn bg-pink-400 btn-rounded btn-icon btn-float">
										<img src="assets/images/placeholder.jpg" class="img-responsive" alt="">
									</a>
									<span class="status-mark border-pink-400"></span>
								</div>
							</li>
						</ul>
					</li>
				</ul>
                </div>
				<div class="content">
					<div class="footer text-muted">
						&copy; 2015. <a href="#">Limitless Web App Kit</a> by <a href="#" target="_blank">Eugene Kopyov</a>
					
					</div>
				</div>
			</div>
			<!-- /main content -->

        </div>
		<!-- /page content -->

    </div>
    <!-- /page container -->



	<!-- Model For Create and Edit Entities -->
	<div id="ajaxModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document" style="min-width:900px">
			<div class="modal-content" style="min-height:300px;">
				<div class="modal-header bg-teal-400">
					<h5 class="modal-title">
						<i class="icon-file-text2 position-left"></i>
						Form
					</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>

				</div>
				<div class="modal-body" id="modalBody">
				</div>

			</div>
		</div>
	</div>


	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.7/dist/sweetalert2.all.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>


	<script>
		$(document).ajaxError(function (event, jqXHR) {
			const swalWithBootstrapButtons = Swal.mixin({
				customClass: {
					confirmButton: 'btn btn-warning ',
				},
				buttonsStyling: false
			});
			if (jqXHR.status === 401) { 
				swalWithBootstrapButtons.fire({
					position: "top",
					title: 'Unauthorized',
					text: 'You are not authorized to perform this action. Please login or contact your administrator.',
					icon: 'warning',
					confirmButtonText: 'OK'
				});
			}
			else if (jqXHR.status === 404) { // Not Found
				Swal.fire({
					position: "top",
					title: 'Not Found',
					text: 'The requested resource could not be found. Please check the URL or contact support.',
					icon: 'error',
					confirmButtonText: 'OK'
				});
			}
		});
	</script>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			var successMessage = document.getElementById("TempDataMessage");

			if (successMessage) {
				setTimeout(function () {
					successMessage.style.display = "none";
				}, 5000);
			}
		});
	</script>

	<script>

		$(document).ready(function () {
			// Handle form submission via AJAX
			$(document).on('submit', '.ajaxForm', function (e) {
				e.preventDefault();

				const form = $(this);
				const url = form.attr('action'); // Get the form action URL


				$.ajax({
					url: url,
					type: 'POST',
					data: form.serialize(),
					success: function (response) {
						if (response.success) {
							$('#ajaxModal').modal('hide');
							localStorage.setItem("toastr_message", response.message);

							
							//$("#refreshUsersBtn").click();
							location.reload();
						} 
						else if (response.success == false) {
							//$('#ajaxModal').modal('hide');
							Swal.fire({
								position: 'top',
								icon: 'warning',
								title: 'Error!',
								text: response.message,
								showConfirmButton: true
							})
						}
						else {
							// Update modal content with returned HTML (e.g., validation errors)
							$('#modalBody').html(response);
						}
					},
					error: function () {
						alert('An error occurred while processing the form.');
					}
					
				});
			});

			// Load modal dynamically with data attributes
			$(document).on('click', '.btnOpenModal', function () {
				const title = $(this).data('title'); // Get the modal title
				const url = $(this).data('url'); // Get the URL to load content from

				// Update modal title
				$('#ajaxModal .modal-title').html(`<i class="icon-file-text2 position-left"></i> ${title}`);

				// Fetch content for the modal
				$.get(url, function (data) {
					$('#modalBody').html(data); // Populate the modal body
					$('#ajaxModal').modal('show'); // Show the modal

					$.validator.unobtrusive.parse('#modalBody');
				});
			});
			// Check if there's a stored success message after reload
			const storedMessage = localStorage.getItem("toastr_message");
			if (storedMessage) {
				toastr.success(storedMessage, "Success", {
					closeButton: true,
					progressBar: true,
					timeOut: 3000,
					positionClass: "toast-top-right"
				});

				localStorage.removeItem("toastr_message");
			}
		});

	</script>

	<script>

		$(document).ready(function () {
			// Handle form submission via AJAX
			$(document).on('submit', '.ajaxEditForm', function (e) {
				e.preventDefault();

				const form = $(this);
				const url = form.attr('action'); // Get the form's action URL

				$.ajax({
					url: url,
					type: 'POST',
					data: form.serialize(),
					success: function (response) {
						if (response.success) {
							$('#ajaxModal').modal('hide');

							// Store success message in localStorage before refreshing
							localStorage.setItem("toastr_message", response.message);

							location.reload();

						} else if (response.success == false) {
							Swal.fire({
								position: 'top',
								icon: 'warning',
								title: 'Error!',
								text: response.message,
								showConfirmButton: true
							});
						} else {
							$('#modalBody').html(response);
						}
					},
					error: function () {
						alert('An error occurred while processing the form.');
					}
				});
			});

			// Load modal content dynamically
			$(document).on('click', '.btnEditOpenModal', function () {
				const title = $(this).data('title') || 'Default Title';
				const url = $(this).data('url');

				$('#ajaxModal .modal-title').html(`<i class="icon-file-text2 position-left"></i> ${title}`);

				$.get(url, function (data) {
					// Check if the response is JSON (branch not found scenario)
					if (typeof data === "object" && data.success === false) {
						Swal.fire({
							position:'top',
							icon: 'error',
							title: 'Error!',
							text: data.message || 'Branch not found.',
							showConfirmButton: true
						});
					} else {
						// Load the modal if data is valid
						$('#modalBody').html(data);
						$('#ajaxModal').modal('show');
					}
				}).fail(function () {
					Swal.fire({
						position:'top',
						icon: 'error',
						title: 'Error!',
						text: 'An error occurred while loading the modal content.',
						showConfirmButton: true
					});
				});
			});


			// Check if there's a stored success message after reload
			const storedMessage = localStorage.getItem("toastr_message");
			if (storedMessage) {
				toastr.success(storedMessage, "Success", {
					closeButton: true,
					progressBar: true,
					timeOut: 3000, 
					positionClass: "toast-top-right"
				});

				localStorage.removeItem("toastr_message");
			}
		});

	</script>

	@await RenderSectionAsync("Scripts", false)

</body> 
</html>
